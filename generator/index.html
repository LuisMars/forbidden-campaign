<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Forbidden Psalm – Warband Builder</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=New+Rocker&family=Open+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../main.css" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="print-card.css" media="print" />
  </head>
  <body>
    <div class="wrap screen-only">
      <h1>Forbidden Psalm – Warband Builder</h1>
      <h2 id="warbandTitle" class="warband-title" style="display: none"></h2>
      <div class="sub">
        Editable warband roster with stash and gold costs. Data persists
        locally.
      </div>
      <div class="grid">
        <div class="column-left">
          <!-- Left: Warband + Stash -->
          <section class="card" id="warbandCard">
            <h2>Warband</h2>
            <div class="row warband-row">
              <input
                id="wbName"
                type="text"
                class="warband-input"
                placeholder="Warband name"
              />
              <button
                id="randWbName"
                type="button"
                class="ghost warband-rand"
                title="Generate a random warband name"
              >
                Random name
              </button>
            </div>
            <div class="row">
              <div class="pill">
                Warband Gold: <strong id="wbGold">50 g</strong>
              </div>
              <button id="addGoldBtn" type="button" class="ghost">Add Gold</button>
            </div>
            <div class="row">
              <label class="pill"
                >Warband XP
                <input
                  id="wbXP"
                  type="number"
                  min="0"
                  step="1"
                  style="width: 100px"
              /></label>
              <label class="pill">
                <button id="levelUpBtn" type="button" class="level-up-btn" title="Spend 5 XP to level up selected character">Level Up (5 XP)</button>
              </label>
            </div>
            <div class="sep"></div>
            <div class="row">
              <button id="addChar" type="button">Add character</button>
            </div>
            <div id="charList" class="list" style="margin-top: 8px"></div>
            <div class="sep"></div>
            <div class="row">
              <button id="exportBtn">Export JSON</button>
              <button id="printRosterBtn" class="ghost" type="button">
                Print roster
              </button>
              <label class="pill" for="importFile" style="cursor: pointer"
                >Import
                <input
                  id="importFile"
                  type="file"
                  accept="application/json"
                  style="display: none"
              /></label>
              <button id="clearAll" class="danger">Clear All</button>
            </div>
          </section>

          <section class="card" id="stashCard">
            <h2>Warband Stash</h2>
            <div class="row">
              <label class="pill"
                >Type
                <select id="stashTypeFilter">
                  <option value="all">All Items</option>
                  <option value="weapon">Weapons</option>
                  <option value="equipment">Equipment</option>
                  <option value="armor">Armor</option>
                  <option value="scroll">Scrolls</option>
                </select>
              </label>
              <select
                id="stashItemSelect"
                aria-label="Available catalog items"
              ></select>
              <button id="stashAddBtn" type="button">Add to Stash</button>
            </div>
            <div class="sep"></div>
            <div id="stashList" class="stash-list"></div>
            <div class="sep"></div>
          </section>
        </div>

        <div class="column-right">
          <!-- Character Editor -->
          <section class="card editor-card" id="editorCard">
            <div id="noSelection" class="editor-empty">
              <div class="empty-icon">⚔️</div>
              <h3>No Character Selected</h3>
              <p>Select a character from your warband to edit their details, stats, and equipment.</p>
            </div>
            <div id="editor" style="display: none">
              <!-- Character Header -->
              <div class="editor-header">
                <div class="character-identity">
                  <div class="name-section">
                    <input id="edName" type="text" placeholder="Character Name" class="character-name-input" />
                    <button id="randCharName" type="button" class="random-name-btn" title="Generate random character name">Random</button>
                  </div>
                </div>
              </div>

              <!-- Character Stats Panel -->
              <div class="editor-section">
                <h3 class="section-title">Combat Stats</h3>
                <div class="stats-display">
                  <div class="attribute-stats">
                    <div class="attribute">
                      <div class="attribute-display" id="edAgi">0</div>
                      <div class="attribute-label">AGI</div>
                    </div>
                    <div class="attribute">
                      <div class="attribute-display" id="edPre">0</div>
                      <div class="attribute-label">PRE</div>
                    </div>
                    <div class="attribute">
                      <div class="attribute-display" id="edStr">0</div>
                      <div class="attribute-label">STR</div>
                    </div>
                    <div class="attribute">
                      <div class="attribute-display" id="edTou">0</div>
                      <div class="attribute-label">TOU</div>
                    </div>
                  </div>
                  <div class="combat-stats">
                    <div class="stat-item">
                      <div class="stat-value" id="edHP">0</div>
                      <div class="stat-label">HP</div>
                    </div>
                    <div class="stat-item">
                      <div class="stat-value" id="edArmor">0</div>
                      <div class="stat-label">Armor</div>
                    </div>
                    <div class="stat-item">
                      <div class="stat-value" id="edMovement">5</div>
                      <div class="stat-label">Movement</div>
                    </div>
                    <div class="stat-item">
                      <div class="stat-value" id="edSlots">0/0</div>
                      <div class="stat-label">Slots</div>
                    </div>
                    <div class="stat-item tragedies-item" id="tragediesGroup" style="display: none">
                      <div class="stat-value" id="edTragedies">0</div>
                      <div class="stat-label">TRG</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="sep"></div>
              <details id="statTemplateBox" class="stat-template-panel">
                <summary class="collapsible-summary">
                  <span class="summary-caret" aria-hidden="true"></span
                  ><span>Stat Template</span>
                </summary>
                <div class="stat-template-body">
                  <div class="row" id="statTemplateControls"></div>
                  <div
                    class="stat-template-values"
                    id="statTemplateValues"
                  ></div>
                  <div class="stat-template-grid" id="statAssignmentGrid"></div>
                </div>
              </details>
              <div class="sep"></div>


              <div class="grid2">
                <div>
                  <h3>Feats</h3>
                  <div class="row trait-controls">
                    <select id="featPicker"></select>
                    <button id="addFeatBtn" type="button">Add</button>
                    <button id="randFeatBtn" class="ghost" type="button">
                      Random
                    </button>
                  </div>
                  <div id="featDetails" class="muted small"></div>
                  <div id="featList" class="trait-list"></div>
                </div>
                <div>
                  <h3>Flaws</h3>
                  <div class="row trait-controls">
                    <select id="flawPicker"></select>
                    <button id="addFlawBtn" type="button">Add</button>
                    <button id="randFlawBtn" class="ghost" type="button">
                      Random
                    </button>
                  </div>
                  <div id="flawDetails" class="muted small"></div>
                  <div id="flawList" class="trait-list"></div>
                </div>
              </div>
              <div class="sep"></div>
              <div>
                <h3>Injuries</h3>
                <div class="row trait-controls">
                  <select id="injuryPicker"></select>
                  <button id="addInjuryBtn" type="button">Add</button>
                  <button id="randInjuryBtn" class="ghost" type="button">
                    Random
                  </button>
                </div>
                <div id="injuryDetails" class="muted small"></div>
                <div id="injuryList" class="trait-list"></div>
              </div>
              <div class="sep"></div>
              <div class="grid2">
                <div>
                  <h3>Weapons</h3>
                  <div id="edWeapons"></div>
                  <div class="row">
                    <select id="addWeaponSel"></select>
                    <button id="addWeaponBtn" class="ghost">Add</button>
                    <button id="buyWeaponBtn">Buy</button>
                  </div>
                  <div id="weaponDetails" class="muted small"></div>
                </div>
                <div>
                  <h3>Armor</h3>
                  <div id="edArmorList"></div>
                  <h3>Shields</h3>
                  <div id="edShieldList"></div>
                  <h3>Helmets</h3>
                  <div id="edHelmList"></div>
                  <h3>Other Gear</h3>
                  <div id="edEquip"></div>
                  <div class="row">
                    <select id="addEquipSel"></select>
                    <button id="addEquipBtn" class="ghost">Add</button>
                    <button id="buyEquipBtn">Buy</button>
                  </div>
                  <div id="equipmentDetails" class="muted small"></div>
                </div>
              </div>
              <div class="sep"></div>
              <div>
                <h3>Personal Stash</h3>
                <div id="edPack" class="list"></div>
              </div>
              <div class="sep"></div>
              <div>
                <div class="row">
                  <h3>Scrolls</h3>
                  <label class="type-toggle">
                    <input type="checkbox" id="isMageToggle" />
                    <span class="toggle-label">Spellcaster</span>
                    <span class="toggle-cost">(+5g)</span>
                  </label>
                  <div class="tragedy-controls" id="tragedyControls" style="display: none">
                    <span class="tragedy-label">Tragedies:</span>
                    <button type="button" id="tragedyMinusBtn" class="ghost small">-</button>
                    <span id="tragedyValue">0</span>
                    <button type="button" id="tragedyPlusBtn" class="ghost small">+</button>
                    <button type="button" id="tragedyResetBtn" class="ghost small">Reset</button>
                  </div>
                </div>
                <div class="grid2">
                  <div>
                    <div class="trait-section">
                      <h4>Clean Scrolls</h4>
                      <div class="row trait-controls">
                        <select id="cleanScrollPicker"></select>
                        <button id="addCleanScrollBtn" type="button">Add</button>
                        <button
                          id="randCleanScrollBtn"
                          class="ghost"
                          type="button"
                        >
                          Random
                        </button>
                      </div>
                      <div id="cleanScrollDetails" class="muted small"></div>
                      <div id="cleanScrollList" class="trait-list"></div>
                    </div>
                  </div>
                  <div>
                    <div class="trait-section">
                      <h4>Unclean Scrolls</h4>
                      <div class="row trait-controls">
                        <select id="uncleanScrollPicker"></select>
                        <button id="addUncleanScrollBtn" type="button">
                          Add
                        </button>
                        <button
                          id="randUncleanScrollBtn"
                          class="ghost"
                          type="button"
                        >
                          Random
                        </button>
                      </div>
                      <div id="uncleanScrollDetails" class="muted small"></div>
                      <div id="uncleanScrollList" class="trait-list"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="sep"></div>
              <div>
                <h3>Notes</h3>
                <textarea
                  id="edNotes"
                  placeholder="Freeform notes"
                ></textarea>
              </div>
              </div>
            </div>
          </section>
        </div>
      </div>
      <footer class="site-footer">
        <p>
          Independent production by
          <a href="https://github.com/luismars" target="_blank" rel="noopener"
            >luismars</a
          >, not affiliated with Ockult Örtmästare Games, Stockholm Kartell, or
          KRD Designs; published under the
          <a href="https://morkborg.com/license/" target="_blank" rel="noopener"
            >MÖRK BORG Third Party License</a
          >. “<a href="https://www.forbiddenpsalm.com/" target="_blank" rel="noopener">Forbidden Psalm</a>” referenced for compatibility only; no endorsement
          implied.
        </p>
        <p>
          <a href="../" class="back-link"
            >Return to the Forbidden Campaign Toolkit home</a
          >
        </p>
      </footer>
    </div>

    <div id="printRoster" class="print-only"></div>

    <!-- Level Up Modal -->
    <div id="levelUpModal" class="modal-overlay" style="display: none;">
      <div class="modal-content level-up-modal">
        <div class="modal-header">
          <h2>Level Up - Spend 5 XP</h2>
          <button class="modal-close" id="levelUpClose">&times;</button>
        </div>
        <div class="modal-body">
          <p>Choose one upgrade option:</p>

          <div class="character-selector">
            <label for="levelUpCharacterSelect">Apply to Character:</label>
            <select id="levelUpCharacterSelect">
              <option value="">Select a character...</option>
            </select>
          </div>

          <div class="level-up-options">
            <label class="level-up-option">
              <input type="radio" name="levelUpChoice" value="improveStat">
              <div class="option-content">
                <strong>Improve 1 warband member's Stat by 1</strong>
                <p>Select a stat to increase (no maximum limit)</p>
                <div class="option-controls" id="statControls" style="display: none;">
                  <select id="statSelect">
                    <option value="agi">Agility</option>
                    <option value="pre">Presence</option>
                    <option value="str">Strength</option>
                    <option value="tou">Toughness</option>
                  </select>
                </div>
              </div>
            </label>

            <label class="level-up-option">
              <input type="radio" name="levelUpChoice" value="removeInjury">
              <div class="option-content">
                <strong>Remove an Injury</strong>
                <p>Remove a flaw from this character</p>
                <div class="option-controls" id="injuryControls" style="display: none;">
                  <select id="injurySelect">
                    <option value="">Select an injury to remove...</option>
                  </select>
                </div>
              </div>
            </label>

            <label class="level-up-option">
              <input type="radio" name="levelUpChoice" value="rerollFlaw">
              <div class="option-content">
                <strong>Reroll a Flaw</strong>
                <p>Replace an existing flaw with a new random one</p>
                <div class="option-controls" id="flawControls" style="display: none;">
                  <select id="flawSelect">
                    <option value="">Select a flaw to reroll...</option>
                  </select>
                </div>
              </div>
            </label>

            <label class="level-up-option">
              <input type="radio" name="levelUpChoice" value="gainFeat">
              <div class="option-content">
                <strong>Gain a new Feat [pick]</strong>
                <p>Choose a feat to add to this character</p>
                <div class="option-controls" id="featControls" style="display: none;">
                  <select id="featSelect">
                    <option value="">Select a feat to gain...</option>
                  </select>
                </div>
              </div>
            </label>

            <label class="level-up-option">
              <input type="radio" name="levelUpChoice" value="resurrect">
              <div class="option-content">
                <strong>Bring 1 warband member back from the Dead</strong>
                <p>Resurrect a dead character with a new random flaw</p>
                <div class="option-controls" id="resurrectControls" style="display: none;">
                  <select id="resurrectSelect">
                    <option value="">Select a dead character...</option>
                  </select>
                </div>
              </div>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-cancel" id="levelUpCancel">Cancel</button>
          <button class="btn-primary" id="levelUpApply" disabled>Apply Level Up</button>
        </div>
      </div>
    </div>

    <script src="print.js"></script>
    <script src="app.js"></script>
  </body>
</html>
