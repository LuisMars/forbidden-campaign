<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Forbidden Psalm – Warband Builder</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="wrap">
      <h1>Forbidden Psalm – Warband Builder</h1>
      <div class="sub">Editable warband roster with stash and gold costs. Data persists locally.</div>
      <div class="grid">
        <!-- Left: Warband + Characters -->
        <section class="card">
          <h2>Warband</h2>
          <div class="row">
            <input id="wbName" type="text" placeholder="Warband name" />
          </div>
          <div class="row">
            <label class="pill">Gold Limit <input id="wbLimit" type="number" min="0" step="1" style="width:100px"/></label>
            <span id="wbPoints" class="tag">0 g</span>
          </div>
          <div class="sep"></div>
          <div class="row">
            <input id="charName" type="text" placeholder="Add character name"/>
            <button id="addChar">Add</button>
            <button id="randChar" class="ghost" title="Randomize a quick template">Random</button>
          </div>
          <div id="charList" class="list" style="margin-top:8px"></div>
          <div class="sep"></div>
          <div class="row">
            <button id="exportBtn">Export JSON</button>
            <label class="pill" for="importFile" style="cursor:pointer">Import <input id="importFile" type="file" accept="application/json" style="display:none"></label>
            <button id="clearAll" class="danger">Clear All</button>
          </div>
        </section>

        <!-- Middle: Character Editor -->
        <section class="card" id="editorCard">
          <h2>Character Editor</h2>
          <div id="noSelection" class="muted">Select a character to edit.</div>
          <div id="editor" style="display:none">
            <div class="row">
              <input id="edName" type="text" placeholder="Name"/>
              <input id="edType" type="text" placeholder="Type / Class"/>
              <label class="pill">Armor <input id="edArmor" type="number" step="1" min="0"/></label>
              <label class="pill" style="gap:6px"><input type="checkbox" id="autoArmor" checked /><span class="small">Auto from equipment</span></label>
              <label class="pill">HP <input id="edHP" type="number" step="1" min="1"/></label>
              <span class="badge nowrap" id="edSlotsBadge">Slots <span id="edSlots">0/0</span></span>
              <span class="badge nowrap">Gold <span id="edPoints">0</span></span>
            </div>
            <div class="sep"></div>
            <div class="stat-grid">
              <label class="pill">Agi <input id="edAgi" type="number" step="1" min="-5" max="5" readonly/></label>
              <label class="pill">Pre <input id="edPre" type="number" step="1" min="-5" max="5" readonly/></label>
              <label class="pill">Str <input id="edStr" type="number" step="1" min="-5" max="5" readonly/></label>
              <label class="pill">Tou <input id="edTou" type="number" step="1" min="-5" max="5" readonly/></label>
            </div>
            <div class="sep"></div>
            <details id="statTemplateBox" class="stat-template-panel" open>
              <summary class="collapsible-summary"><span class="summary-caret" aria-hidden="true"></span><span>Stat Template</span></summary>
              <div class="stat-template-body">
                <div class="row" id="statTemplateControls"></div>
                <div class="stat-template-values" id="statTemplateValues"></div>
                <div class="stat-template-grid" id="statAssignmentGrid"></div>
              </div>
            </details>
            <div class="sep"></div>
            <div class="grid2">
              <div>
                <h3>Feats</h3>
                <textarea id="edFeats" placeholder="One per line"></textarea>
              </div>
              <div>
                <h3>Flaws</h3>
                <textarea id="edFlaws" placeholder="One per line"></textarea>
              </div>
            </div>
            <div class="sep"></div>
            <div class="grid2">
              <div>
                <h3>Weapons</h3>
                <div id="edWeapons"></div>
                <div class="row">
                  <select id="addWeaponSel"></select>
                  <button id="addWeaponBtn">Add</button>
                </div>
              </div>
              <div>
                <h3>Armor</h3>
                <div id="edArmorList"></div>
                <h3>Shields</h3>
                <div id="edShieldList"></div>
                <h3>Helmets</h3>
                <div id="edHelmList"></div>
                <h3>Other Gear</h3>
                <div id="edEquip"></div>
                <div class="row">
                  <select id="addEquipSel"></select>
                  <button id="addEquipBtn">Add</button>
                </div>
              </div>
            </div>
            <div class="sep"></div>
            <div>
              <h3>Personal Stash</h3>
              <div id="edPack" class="list"></div>
            </div>
            <div class="sep"></div>
            <div class="grid2">
              <div>
                <h3>Scrolls</h3>
                <div class="row">
                  <label class="pill">Clean <input id="edClean" type="number" min="0" step="1"/></label>
                  <label class="pill">Unclean <input id="edUnclean" type="number" min="0" step="1"/></label>
                </div>
              </div>
              <div>
                <h3>Notes</h3>
                <textarea id="edNotes" placeholder="Freeform notes"></textarea>
              </div>
            </div>
          </div>
        </section>

        <!-- Right: Stash & Points -->
        <section class="card">
          <h2>Warband Stash</h2>
          <div class="row">
            <input id="newItemName" type="text" placeholder="Item name"/>
            <select id="newItemType">
              <option value="weapon">Weapon</option>
              <option value="equipment">Equipment</option>
              <option value="armor">Armor</option>
              <option value="scroll">Scroll</option>
            </select>
            <input id="newItemCost" type="number" step="1" min="0" placeholder="Cost"/>
            <button id="addItem">Add to Stash</button>
          </div>
          <table class="table" style="margin-top:8px">
            <thead><tr><th>Name</th><th>Type</th><th>Attrs</th><th class="right">Qty</th><th class="right">Cost</th><th></th></tr></thead>
            <tbody id="stash"></tbody>
          </table>

          <div class="sep"></div>
          <details>
            <summary>Catalog Editor</summary>
            <div class="small o" style="margin:6px 0 10px">Edit item types and gold costs. These apply to all characters.</div>
            <table class="table">
              <thead><tr><th>Name</th><th>Type</th><th>DMG</th><th>Attr</th><th>Traits</th><th>Slots</th><th>Slot Bonus</th><th>AV</th><th>Notes</th><th class="right">Cost (g)</th><th></th></tr></thead>
              <tbody id="catalog"></tbody>
            </table>
            <div class="sep"></div>
            <div class="row">
              <button id="exportCatalog" class="ghost">Export Catalog</button>
              <label class="pill" for="importCatalogFile" style="cursor:pointer">Import Catalog <input id="importCatalogFile" type="file" accept="application/json" style="display:none"></label>
              <button id="resetCatalog" class="danger">Reset to Seed</button>
            </div>
            <div class="sep"></div>
            <details>
              <summary>Bulk Import/Update (CSV)</summary>
              <div class="small o" style="margin:6px 0 10px">Columns: name,type,cost,dmg,attr,traits,slots,slotBonus,av,notes. Existing items update by name.</div>
              <textarea id="bulkCsv" placeholder="Shortsword,weapon,5,D6,Agi,,1,0,,\nLight Armor,armor,10,,,,1,0,1,"></textarea>
              <div class="row"><button id="applyBulk">Apply CSV</button></div>
            </details>
          </details>

          <div class="sep"></div>
        </section>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>
